name: Build Python for Windows

on:
  workflow_dispatch:  # Allows manual trigger
  push:
    branches: [main]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup MSVC
        uses: ilammy/msvc-dev-cmd@v1
      
      - name: Download Python Source
        run: |
          curl -L -O https://www.python.org/ftp/python/3.10.16/Python-3.10.16.tgz
          tar -xzf Python-3.10.16.tgz
        shell: bash
      
      - name: Build Python
        run: |
          cd Python-3.10.16/PCbuild
          ./build.bat -p x64 -c Release
        shell: cmd
      
      - name: List build output
        run: |
          echo "Listing build directory contents:"
          ls -R Python-3.10.16/PCbuild/
        shell: bash
      
      - name: Package Build
        run: |
          cd Python-3.10.16/PCbuild/amd64
          Compress-Archive -Path * -DestinationPath ../../../python-3.10.16-windows-x64.zip
        shell: pwsh
      
      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: python-windows-build
          path: python-3.10.16-windows-x64.zip
